(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0e5bcf"],{9684:function(t,e,a){"use strict";a.r(e);var r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("v-title",{attrs:{title:"编辑负载"}},[t.upstream.queries&&t.upstream.queries.length>0?[t._v("\n            搜索路径："),t._l(t.upstream.queries,(function(e){return a("span",{staticClass:"badge badge-dark ml-1"},[t._v(t._s(e))])}))]:t._e()],2),a("div",{staticClass:"p-3"},[a("div",{staticClass:"form-group"},[a("div",{staticClass:"input-group"},[t._m(0),a("select",{directives:[{name:"model",rawName:"v-model",value:t.upstream.protocol,expression:"upstream.protocol"}],staticClass:"form-control",staticStyle:{width:"140px"},on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.upstream,"protocol",e.target.multiple?a:a[0])}}},[a("option",{attrs:{value:"http"}},[t._v("HTTP")]),a("option",{attrs:{value:"tcp"}},[t._v("TCP")]),a("option",{attrs:{value:"udp"}},[t._v("UDP")])]),t._m(1),a("input",{directives:[{name:"model",rawName:"v-model",value:t.upstream.name,expression:"upstream.name"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:t.upstream.name},on:{input:function(e){e.target.composing||t.$set(t.upstream,"name",e.target.value)}}}),t._m(2),a("select",{directives:[{name:"model",rawName:"v-model",value:t.upstream.loadStrategy,expression:"upstream.loadStrategy"}],staticClass:"form-control",on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.upstream,"loadStrategy",e.target.multiple?a:a[0])}}},[a("option",{attrs:{value:""}},[t._v("默认")]),a("option",{attrs:{value:"ip_hash"}},[t._v("IP哈希（ip_hash）")]),a("option",{attrs:{value:"fair"}},[t._v("页面大小、加载时间长短智能（fair）")]),a("option",{attrs:{value:"url_hash"}},[t._v("URL哈希（url_hash）")]),a("option",{attrs:{value:"least_conn"}},[t._v("最少连接（least_conn）")]),a("option",{attrs:{value:"least_time"}},[t._v("最短时间（least_time）")]),a("option",{attrs:{value:"hash"}},[t._v("哈希（hash）")]),a("option",{attrs:{value:"sticky"}},[t._v("会话保持 (sticky)")])])])]),a("div",{staticClass:"form-group"},[a("div",{staticClass:"input-group"},[t._m(3),a("input",{directives:[{name:"model",rawName:"v-model",value:t.upstream.commit,expression:"upstream.commit"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:t.upstream.commit},on:{input:function(e){e.target.composing||t.$set(t.upstream,"commit",e.target.value)}}})])]),a("table",{staticClass:"table table-hover table-bordered"},[a("thead",{staticClass:"thead-light"},[a("tr",[a("td",{attrs:{colspan:"7"}},[t._v("\n                    负载\n                    "),a("button",{staticClass:"btn btn-sm btn-outline-danger pull-right",on:{click:t.addServer}},[t._v("\n                        添加负载\n                    ")])])]),t._m(4)]),a("tbody",t._l(t.upstream.servers,(function(e,r){return a("tr",[a("td",[a("input",{directives:[{name:"model",rawName:"v-model",value:t.upstream.servers[r].host,expression:"upstream.servers[idx].host"}],staticClass:"form-control",attrs:{placeholder:"IP",type:"text"},domProps:{value:t.upstream.servers[r].host},on:{input:function(e){e.target.composing||t.$set(t.upstream.servers[r],"host",e.target.value)}}})]),a("td",[a("input",{staticClass:"form-control",attrs:{placeholder:"port",type:"number",max:"65535",min:"1"},domProps:{value:t.upstream.servers[r].port},on:{change:function(e){t.upstream.servers[r].port=Number(e.target.value)}}})]),a("td",[a("input",{staticClass:"form-control",attrs:{placeholder:"port",type:"number",min:"0"},domProps:{value:t.upstream.servers[r].weight},on:{change:function(e){t.upstream.servers[r].weight=Number(e.target.value)}}})]),a("td",[a("input",{staticClass:"form-control",attrs:{placeholder:"port",type:"number",min:"0"},domProps:{value:t.upstream.servers[r].failTimeout},on:{change:function(e){t.upstream.servers[r].failTimeout=Number(e.target.value)}}})]),a("td",[a("input",{staticClass:"form-control",attrs:{placeholder:"port",type:"number",min:"0"},domProps:{value:t.upstream.servers[r].maxFails},on:{change:function(e){t.upstream.servers[r].maxFails=Number(e.target.value)}}})]),a("td",[a("select",{directives:[{name:"model",rawName:"v-model",value:t.upstream.servers[r].status,expression:"upstream.servers[idx].status"}],staticClass:"form-control",on:{change:function(e){var a=Array.prototype.filter.call(e.target.options,(function(t){return t.selected})).map((function(t){var e="_value"in t?t._value:t.value;return e}));t.$set(t.upstream.servers[r],"status",e.target.multiple?a:a[0])}}},[a("option",{attrs:{value:""}},[t._v("无")]),a("option",{attrs:{value:"down"}},[t._v("停用（down）")]),a("option",{attrs:{value:"backup"}},[t._v("备用（backup）")])])]),a("td",[a("button",{staticClass:"btn btn-sm btn-danger",on:{click:function(e){return t.removeServer(r)}}},[t._v("删除\n                    ")])])])})),0)]),a("HideCard",{attrs:{title:"额外参数",show:!0}},[a("Partamters",{model:{value:t.upstream.parameters,callback:function(e){t.$set(t.upstream,"parameters",e)},expression:"upstream.parameters"}})],1)],1),a("div",{staticClass:"d-flex justify-content-center"},[a("button",{staticClass:"btn btn-primary",on:{click:t.modfiyUpstream}},[t._v("　确　定　")]),a("router-link",{staticClass:"btn btn-default ml-3",attrs:{to:"/admin/upstreams"}},[t._v("　取　消　")])],1)],1)},s=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"input-group-prepend"},[a("span",{staticClass:"input-group-text"},[t._v("转发类型")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"input-group-prepend"},[a("span",{staticClass:"input-group-text"},[t._v("名称")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"input-group-prepend"},[a("span",{staticClass:"input-group-text"},[t._v("负载策略")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"input-group-prepend"},[a("span",{staticClass:"input-group-text"},[t._v("备注")])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("tr",[a("td",[t._v("IP")]),a("td",[t._v("端口")]),a("td",[t._v("权重")]),a("td",[t._v("失败等待时间(s)")]),a("td",[t._v("最大失败次数")]),a("td",[t._v("状态")]),a("td",{attrs:{width:"80px"}},[t._v("操作")])])}],n=(a("cc57"),a("c0cf")),o=a("75f7"),i=a("fc76"),u=a("8a2b"),l=(a("fe51"),a("8561"),{name:"UpstreamEdit",components:{HideCard:i["a"],Partamters:o["a"],VTitle:n["a"],codemirror:u["codemirror"]},data:function(){return{upstream:{},cmOptions:{tabSize:4,theme:"lesser-dark",mode:"json",line:!0,lineWrapping:!0,lineNumbers:!0,collapseIdentical:!1,highlightDifferences:!0}}},mounted:function(){this.$route.query.name?this.getUpstream():this.upstream={queries:[],name:"",commit:"",protocol:"http",loadStrategy:"",servers:[{host:"127.0.0.1",port:8080,weight:0,failTimeout:0,maxFails:0,status:""}],parameters:[]}},methods:{getUpstream:function(){var t=this,e="/admin/api/upstream?name="+t.$route.query.name;t.$axios.get(e).then((function(e){t.upstream=e[0]})).catch((function(e){t.$alert(e.message)}))},addServer:function(){this.upstream.servers.push({host:"",port:8080,weight:1,failTimeout:3,maxFails:3,status:""})},removeServer:function(t){this.upstream.servers.splice(t,1)},modfiyUpstream:function(){var t=this;t.$axios.post("/admin/api/upstream",this.upstream).then((function(e){t.$toast.success("更新成功！"),t.$router.push({path:"/admin/upstreams"})})).catch((function(e){t.$alert(e.message)}))}},computed:{upstreamString:function(){return JSON.stringify(this.upstream,null,"\t")}}}),p=l,m=a("c701"),c=Object(m["a"])(p,r,s,!1,null,null,null);e["default"]=c.exports}}]);
//# sourceMappingURL=chunk-2d0e5bcf.c5aade83.js.map